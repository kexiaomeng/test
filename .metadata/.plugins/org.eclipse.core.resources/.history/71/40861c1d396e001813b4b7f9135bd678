package com.nari.sun.netty.handler;

import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

import sun.org.mozilla.javascript.internal.Token.CommentType;

import com.nari.sun.netty.obj.CommType;
import com.nari.sun.netty.obj.Header;
import com.nari.sun.netty.obj.NettyMessage;

import io.netty.channel.ChannelHandlerAdapter;
import io.netty.channel.ChannelHandlerContext;
/**
 * 服务端响应握手认证
 * @author lenovo
 *
 */
public class LoginAuthRespHandler extends ChannelHandlerAdapter{
	private Map<String, Boolean> ipCheck = new ConcurrentHashMap<String, Boolean>(); 
	private static List<String> whiteList = new ArrayList<String>();
	//登陆白名单设置
	static{
		whiteList.add("127.0.0.1");
		
	}
//	@Override
//	 public void channelActive(ChannelHandlerContext ctx)throws Exception{
//    	buildLoginReq(ctx);
//	}
	@Override
	public void channelRead(ChannelHandlerContext ctx,Object obj)throws Exception{
    	NettyMessage msg = (NettyMessage)obj;
    	Header header = msg.getHeader();
    	
    	String ipAddr = ctx.channel().remoteAddress().toString();
    	NettyMessage loginResp = null;
    	
    	if(header != null && header.getType() == (byte)CommType.TYPE_3.getId()){
    		if( != (byte)0){
    			System.out.println("握手失败，断开连接");
    			ctx.close();
    		}else {
				System.out.println("连接成功");
				ctx.fireChannelRead(obj);
			}
    	}else{
    		ctx.fireChannelRead(obj);
    	}
	}
	@Override 
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause)
        throws Exception{
        ctx.fireExceptionCaught(cause);
    }
	
	/**
	 * 创建握手信息
	 * @param ctx
	 * @return
	 */
	private NettyMessage buildLoginReq(ChannelHandlerContext ctx) {
		// TODO Auto-generated method stub
		NettyMessage msg = new NettyMessage();
		
		Header header = new Header();
		
		header.setType((byte)CommType.TYPE_3.getId());
		msg.setHeader(header);
		return msg;
	}
	
}
